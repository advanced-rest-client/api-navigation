<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <title>api-navigation test</title>
    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <script src="amf-loader.js"></script>
    <script src="../amf-helper.js"></script>
    <link rel="import" href="../../arc-polyfills/arc-polyfills.html">
  </head>
  <body>
    <script>
    /* global AmfLoader, ApiNavigationAmfHelper */
    suite('AMF helper', () => {
      let amf;
      suiteSetup(() => {
        return AmfLoader.load()
        .then((model) => amf = model);
      });

      test('Initializes the class', () => {
        const instance = new ApiNavigationAmfHelper(amf);
        assert.equal(instance.baseId, 'file://demo/api.raml');
      });

      test('Throws error when no model', () => {
        assert.throws(() => {
          new ApiNavigationAmfHelper();
        });
      });

      test('Collects documentaion information', () => {
        const instance = new ApiNavigationAmfHelper(amf);
        const result = instance.collect();
        assert.isAbove(result.documentation.length, 0);
        assert.typeOf(result.documentation[0].id, 'string');
        assert.typeOf(result.documentation[0].label, 'string');
      });

      test('Collects types information', () => {
        const instance = new ApiNavigationAmfHelper(amf);
        const result = instance.collect();
        assert.isAbove(result.types.length, 0);
        assert.typeOf(result.types[0].id, 'string');
        assert.typeOf(result.types[0].label, 'string');
      });

      test('Collects security information', () => {
        const instance = new ApiNavigationAmfHelper(amf);
        const result = instance.collect();
        assert.isAbove(result.securitySchemes.length, 0);
        assert.typeOf(result.securitySchemes[0].id, 'string');
        assert.typeOf(result.securitySchemes[0].label, 'string');
      });

      test('Collects endpoints information', () => {
        const instance = new ApiNavigationAmfHelper(amf);
        const result = instance.collect();
        assert.isAbove(result.endpoints.length, 0);
        assert.typeOf(result.endpoints[0].id, 'string');
        assert.typeOf(result.endpoints[0].label, 'string');
        assert.typeOf(result.endpoints[0].methods, 'array');
      });

      test('Collects methods information', () => {
        const instance = new ApiNavigationAmfHelper(amf);
        const result = instance.collect();
        const methods = result.endpoints[0].methods;
        assert.isAbove(methods.length, 0);
        assert.typeOf(methods[0].id, 'string');
        assert.typeOf(methods[0].label, 'string');
        assert.typeOf(methods[0].method, 'string');
      });
    });
    </script>
  </body>
</html>
